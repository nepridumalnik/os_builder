set(TARGET kernel)

set(SOURCES
    main.asm
)

set(FORMAT bin)

set(OUTPUT_KERNEL_PATH ${CMAKE_BINARY_DIR}/${TARGET}.${FORMAT})

add_custom_command(
    OUTPUT ${OUTPUT_KERNEL_PATH}
    COMMAND nasm ${SOURCES} -o ${OUTPUT_KERNEL_PATH} -f bin
    COMMAND truncate -s 1440k ${OUTPUT_KERNEL_PATH}
    DEPENDS ${SOURCES}
    WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
    COMMENT "Assembling ${SOURCES} to ${TARGET}"
)

add_custom_target(${TARGET} ALL DEPENDS ${OUTPUT_KERNEL_PATH})
set_target_properties(${TARGET} PROPERTIES OUTPUT_NAME ${OUTPUT_KERNEL_PATH})
